<header class="secondary">
	<h2><%= @collection.label %></h2>
	<span class="controls">
		<% if @collection.can_create %>
			<a href="/<%= settings.base_route %>/collections/<%= @collection.id %>/item">
				New <%= @collection.id %>
			</a>
		<% end %>
		<% if settings.build_command %>
			<form id="publish-form" action="/<%= settings.base_route %>/publish" method="post">
				<button type="submit" form="publish-form">Publish site</button>
			</form>
		<% end %>
	</span>
</header>
<% if @collection.description %>
	<p id="collection-description"><%= @collection.description %></p>
<% end %>
<form id="filters-form" class="controls --right" action="" method="get">
	<label class="--horizontal" for="sort">Sort</label>
	<select id="sort" name="sort">
		<% for option in RobinCMS::Item::SORT_OPTIONS %>
			<option
				value="<%= option[:value] %>"
				<% if query_params['sort'] == option[:value] %>
					selected
				<% end %>
			>
				<%= option[:label] %>
			</option>
		<% end %>
	</select>
	<label class="--horizontal" for="status">Status</label>
	<select id="status" name="status">
		<% for option in RobinCMS::Item::STATUS_OPTIONS%>
			<option
				value="<%= option[:value] %>"
				<% if query_params['status'] == option[:value] %>
					selected
				<% end %>
			>
				<%= option[:label] %>
			</option>
		<% end %>
	</select>
	<label class="--horizontal" for="search">Search</label>
	<input id="search" name="q" type="search" value="<%= query_params['q'] %>" />
	<button type="submit">Apply</button>
</form>
<% if @items.length == 0 %>
	<p id="no-items">
		Nothing to show.
		<% if @collection.can_create %>
			Create a <a href="/<%= settings.base_route %>/collections/<%= @collection.id %>/item">new <%= @collection.label_singular %></a>.
		<% end %>
	</p>
<% else %>
	<table>
		<tr>
			<th class="grow">Name</th>
			<th>Created at</th>
			<th>Last updated</th>
			<th></th>
			<th></th>
		</tr>
		<% for item in @items %>
			<tr>
				<td>
					<a href="/<%= settings.base_route %>/collections/<%= @collection.id %>/item?id=<%= item.id %>">
						<%= item.fields[:title] %>
					</a>
				</td>
				<td>
					<%= Time.parse(item.fields[:created_at]).strftime('%b %d, %Y') %>
				</td>
				<td>
					<%= Time.parse(item.fields[:updated_at]).strftime('%b %d, %Y') %>
				</td>
				<td class="controls">
					<a href="/<%= settings.base_route %>/collections/<%= @collection.id %>/item?id=<%= item.id %>">
						Edit
					</a>
				</td>
				<td>
					<% if @collection.can_delete %>
						<%= erb :dialog, locals: {
							id: "delete#{item.id}",
							heading: "Delete #{item.fields[:title]}?",
							body: "Are you sure you want to delete #{item.fields[:title]}?",
							action: "/#{settings.base_route}/collections/#{@collection.id}/item/delete?id=#{item.id}",
							button_label: 'Delete',
							danger: true
						} %>
					<% end %>
				</td>
			</tr>
		<% end %>
	</table>
<% end %>
